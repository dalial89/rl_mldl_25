import gym
import pandas as pd
from env.custom_hopper import *
from stable_baselines3 import PPO
from stable_baselines3.common.evaluation import evaluate_policy
from stable_baselines3.common.vec_env import DummyVecEnv

SEED = 42
N_EVAL_EPISODES = 50
UDR = True  

def main():
    model = PPO.load("Simopt_ppo_policy_final")

    env_name = 'CustomHopper-target-v0'
    real_env = gym.make(env_name)
    real_env.seed(SEED)
    real_env.action_space.seed(SEED)
    real_env = DummyVecEnv([lambda: real_env])

    # Evaluate policy
    mean_reward, std_reward = evaluate_policy(model, real_env, n_eval_episodes=N_EVAL_EPISODES, render=False)

    print(f"Mean Reward: {mean_reward:.2f} | Std Reward: {std_reward:.2f}")

    # Prepara il CSV
    results = [["sourceâ†’target", env_name, SEED, UDR, mean_reward, std_reward, N_EVAL_EPISODES]]

    df = pd.DataFrame(results, columns=['setup', 'env', 'seed', 'udr', 'mean', 'std', 'episodes'])
    df.to_csv('test_results.csv', index=False)
    print("Test results saved as test_results.csv.")

if __name__ == '__main__':
    main()
